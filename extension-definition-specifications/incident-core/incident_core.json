{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/oasis-open/cti-stix-common-objects/main/extension-definition-specifications/incident-core/incident_core.json",
    "title": "DC3 Incident Core Extension",
    "description": "A core extension of the Incident object to allow core details of the Incident to be shared while tracking major details tied to the incident's timeline.  Multiple Incidents can be tied together via relationships if a higher degree of fidelity is needed across phases.",
    "type": "object",
    "required": [
        "extension_type"
        , "determination"
        , "investigation_status"
    ],
    "additionalProperties": false,
    "properties": {
        "extension_type": {
            "type": "string",
            "description": "Defined by STIX 2.1 extension definition rules from 'extension-type-enum'.",
            "enum": [
                "property-extension"
            ]
        },
        "additional_ids": {
            "description": "A list of other IDs used to track this Incident across various systems", 
            "type": "array",
            "items": {
                "type": "object",
                "required": ["id", "name"],
                "properties": {
                    "id": {
                        "type": "string",
                        "description": "The ID value"
                    },
                    "name": {
                        "type": "string",
                        "description": "The name or system that uses this ID value for tracking"
                    }
                }
            }
        },
        "scores": {
            "type": "array",
            "description": "A list of scores from various automated or manual mechanisms along with optional descriptions",
            "items": {
                "type": "object",
                "required": ["name", "value"],
                "properties": {
                    "name" : {
                        "type": "string",
                        "description": "The name of the score.  This is normally a system or process name or some combination of these such as [Tool Name] Automated Exposure Score"
                    },
                    "value": {
                        "type": "number",
                        "description": "The numeric score."
                    },
                    "description": {
                        "type": "string",
                        "description": "An optional description about how this score was arrived at for systems that provide these"
                    }
                }
            }
        },
        "determination": {
            "type": "string",
            "description": "If the incident has been confirmed or is suspected.  If it is determined to be benign it is considered a false-positive.",
            "enum": [
                "suspected"
                , "confirmed"
                , "false-positive"
            ]
        },
        "investigation_status": {
            "type": "string",
            "description": "The current status of the incident investigation.",
            "enum": [
                "new"
                , "open"
                , "closed"
            ],
            "$comment": "An Incident should be marked as New until some action is taken"
        },
        "incident_types": {
            "type": "array",
            "description": "This property uses an Open Vocabulary that specifies the type of incident that occurred, if applicable.  This is an open vocabulary and values SHOULD come from the incident-type-ov vocabulary.",
            "minItems": 1,
            "items": {
                "type": "string"
            },
            "$comment": "'blocked', 'failed-attempt', 'under-investigation'; blocked = stopped via affirmative defense, failed-attempt = it didn't succeed but not due to any affirmative defense for example a password guesser failed but was also not rate limited"
        },
        "detection_methods": {
            "type": "array",
            "description": "A list of strings containing what was used to detect the activity, ex. commercial tool names, techniques associated with proprietary solutions, human review, external sources, or other methods.",
            "minItems": 1,
            "items": {
                "type": "string"
            }
        },
        "criticality": {
            "type": "string",
            "description": "How important this incident is to operations",
            "enum": [
                "deprecated",
                "non-critical",
                "critical"
            ],
            "$comment": "I think more granularity is needed here, but not sure how this should be broken up"
        },
        "functional_impact": {
            "type": "string",
            "description": "The functional impact of the incident on operations",
            "enum": [
                "none",
                "minimal",
                "significant",
                "denial",
                "loss-of-control"
            ],
            "$comment": "This scale feels weird to me, but I think it is important to break up the criticality of the system from its impact"
        },
        "information_impacts": {
            "type": "array",
            "description": "If information has been lost, compromised or otherwise corrupted.  Multiple items can be entered here as an incident can include multiple forms of data theft or destruction.",
            "minItems": 1,
            "items": {
                "type": "object",
                "additionalProperties": false,
                "required": ["impact", "impact_type"],
                "properties": {
                    "impact_type": {
                        "type": "string",
                        "$comment": "Open Vocabulary including: 'pii', 'phi', 'proprietary', 'credentials', 'classified-material' from https://us-cert.cisa.gov/incident-notification-guidelines but will also likely draw in other sources"
                    },
                    "impact": {
                        "type": "string",
                        "enum": ["suspected", "destruction", "loss", "major-loss"]
                    }
                }
            }
        },
        "recoverability": {
            "type": "string",
            "description": "The scope of impact required to recover from an incident",
            "enum": [
                "not-applicable",
                "regular",
                "supplemented",
                "extended",
                "not-recoverable"
            ],
            "$comment": "This is a closed vocabulary: non-applicable is an addition to what is found on https://us-cert.cisa.gov/incident-notification-guidelines for Incident reports that do not have associated recover costs.  For example a phishing email that was detected successfully."
        },
        "external_impacts": {
            "type": "array",
            "description": "The scope of impact outside of the direct organization",
            "minItems": 1,
            "items": {
                "type": "string"
            },
            "$comment": "This will be an open vocabulary including: 'national-security', 'foreign-relations', 'economic', 'public-confidence', 'civil-liberties', 'public-health'"
        },
        "mitigation": {
            "type": "string",
            "description": "A description of the steps taken to mitigate this incident.  If available this can be further detailed within defender_activity, but this captures a high level narrative of what has been done instead of a more step by step chain of action."
        },
        "observable_refs": {
            "type": "array",
            "description": "A list of all observed data that was part of this incident.  This can relate directly to SCOs, but can also reference Sightings, Observables, and Indicators.",
            "minItems": 1,
            "items": {
                "type": "string",
                "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/identifier.json"
            }
        },
        "defender_activities": {
            "type": "array",
            "description": "Points in time relevant to the lifecycle of this incident, such as when it was first detected or when the activity first appeared.  Since each entry is a timestamp when recording events with a start end date they should be marked with '-started' or '-completed' as suffixes",
            "items": {
                "type": "object",
                "required": [
                    "activity_type"
                    , "time"
                ],
                "additionalProperties": false,
                "properties": {
                    "course_of_action_ref": {
                        "type": "string",
                        "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/identifier.json",
                        "pattern": "^course-of-action--"
                    },
                    "activity_type": {
                        "type": "string",
                        "description": "A general type for the timestamp for higher level rollups",
                        "$comment": "Open-Vocab including: 'recovery', 'detected', 'declared', 'escalated'"
                    },
                    "is_projection": {
                        "type": "boolean",
                        "description": "If this is a projection of when a future event will occur for example when recovery will be completed.",
                        "default": "false"
                    },
                    "description": {
                        "type": "string",
                        "description": "A description of the adversary activity that occurred."
                    },
                    "time": {
                        "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/timestamp.json",
                        "description": "When this activity occurred"
                    }
                },
                "$comment": "This was included as an array instead of a series of external relationships because course of action is optional, and will often not be included.  As such it allows defenders to provide timestamps of when they performed general actions without needing to provide an explicit course of action object.  Many events including detection also do not fit the standard Course of Action use case so it is unclear if this would be the desired long-term behavior."
            }
        },
        "attacker_activities": {
            "type": "array",
            "description": "A list of attacker focused activities associated with the Incident including information about when these occurred.",
            "items": {
                "type": "object",
                "anyOf": [
                    {
                        "required": [
                            "activity_type"
                        ]
                    },
                    {
                        "required": [
                            "pattern_ref"
                        ]
                    }
                ],
                "additionalProperties": false,
                "properties": {
                    "activity_type": {
                        "type": "string",
                        "description": "A general type for the timestamp for higher level rollups"
                    },
                    "description": {
                        "type": "string",
                        "description": "A description of adversary activity that occurred and in what sequence.  Sequence information defined by the sequence_start and sequence_end properties, not the position in the array.  This allows for indeterminate sequences to be recorded."
                    },
                    "pattern_ref": {
                        "type": "string",
                        "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/identifier.json",
                        "pattern": "^attack-pattern--"
                    },
                    "start_time": {
                        "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/timestamp.json",
                        "description": "The date the activity was first recorded.  If this is not present it is assumed to be unknown."
                    },
                    "end_time": {
                        "$ref": "https://raw.githubusercontent.com/oasis-open/cti-stix2-json-schemas/stix2.1/schemas/common/timestamp.json",
                        "description": "The date the activity was last recorded.  If this is not present it is assumed to be unknown."
                    },
                    "sequence_start": {
                        "type": "number",
                        "description": "An optional sequence number starting at 0 that shows the earlier point in an attack that this activity is believed to have occurred relative to other attacker activities.  This cannot be greater than sequence_end, but the two can be equal.",
                        "minimum": 0
                    },
                    "sequence_end": {
                        "type": "number",
                        "description": "An optional sequence number starting at 0 that shows the lastest point in an attack that this activity is believed to have occurred relative to other attacker activities.  This cannot be less than sequence_start, but the two can be equal.",
                        "minimum": 0
                    }
                }
            }
        }
    }
}